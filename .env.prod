#!/usr/bin/env bash
# =============================================================================
# .env — Odoo 19 Cluster + YugabyteDB Configuration
# Copy this file to every node before running any script.
# Do NOT commit this file to version control (add to .gitignore).
# =============================================================================

# ── General ──────────────────────────────────────────────────────────────────
CLUSTER_ENV="production"              # production | staging | dev
CLUSTER_TIMEZONE="UTC"
CLUSTER_LOCALE="en_US.UTF-8"
CLUSTER_DOMAIN="odoo.example.com"

# ── Network: Virtual IP & Load Balancers ─────────────────────────────────────
VIP_IP="192.168.1.10"
VIP_CIDR="24"
VIP_INTERFACE="eth0"
VIP_ROUTER_ID="51"
VIP_AUTH_PASS="KeepAliveSecret2024!"

LB_PRIMARY_HOST="haproxy-01"
LB_PRIMARY_IP="192.168.1.11"
LB_BACKUP_HOST="haproxy-02"
LB_BACKUP_IP="192.168.1.12"
LB_STATS_PORT="8404"
LB_STATS_USER="admin"
LB_STATS_PASS="HAProxyAdmin!2024"

# ── Network: Odoo Application Nodes ──────────────────────────────────────────
ODOO_NODE1_HOST="odoo-app-01"
ODOO_NODE1_IP="192.168.1.21"
ODOO_NODE2_HOST="odoo-app-02"
ODOO_NODE2_IP="192.168.1.22"
ODOO_HTTP_PORT="8069"
ODOO_LONGPOLL_PORT="8072"
ODOO_GEVENT_PORT="8072"

# ── Network: YugabyteDB Nodes ─────────────────────────────────────────────────
YB_NODE1_HOST="yb-node-01"
YB_NODE1_IP="192.168.1.31"
YB_NODE2_HOST="yb-node-02"
YB_NODE2_IP="192.168.1.32"
YB_NODE3_HOST="yb-node-03"
YB_NODE3_IP="192.168.1.33"
YB_MASTER_PORT="7100"
YB_TSERVER_RPC_PORT="9100"
YB_YSQL_PORT="5433"
YB_MASTER_WEB_PORT="7000"
YB_TSERVER_WEB_PORT="9000"
YB_REPLICATION_FACTOR="3"

# ── Network: Redis ────────────────────────────────────────────────────────────
REDIS_HOST="redis-01"
REDIS_IP="192.168.1.41"
REDIS_PORT="6379"
REDIS_DB="0"
REDIS_PREFIX="odoo19_"
REDIS_MAXMEMORY="2gb"

# ── Network: NFS ─────────────────────────────────────────────────────────────
NFS_SERVER_HOST="nfs-01"
NFS_SERVER_IP="192.168.1.51"
NFS_EXPORT_PATH="/export/odoo/filestore"
NFS_MOUNT_PATH="/mnt/odoo-filestore"

# ── Network: PgBouncer ───────────────────────────────────────────────────────
PGBOUNCER_HOST="127.0.0.1"
PGBOUNCER_PORT="6432"
PGBOUNCER_POOL_MODE="transaction"
PGBOUNCER_MAX_CLIENT_CONN="500"
PGBOUNCER_DEFAULT_POOL_SIZE="40"
PGBOUNCER_RESERVE_POOL_SIZE="10"

# ── YugabyteDB Software ───────────────────────────────────────────────────────
YB_VERSION="2.21.1.0"
YB_BUILD="b545"
YB_INSTALL_DIR="/opt/yugabyte"
YB_DATA_DIR="/data/yugabyte"
YB_LOG_DIR="/var/log/yugabyte"
YB_CONFIG_DIR="/etc/yugabyte"
YB_USER="yugabyte"
YB_GROUP="yugabyte"
YB_DOWNLOAD_URL="https://downloads.yugabyte.com/releases/${YB_VERSION}/yugabyte-${YB_VERSION}-${YB_BUILD}-linux-x86_64.tar.gz"

# YugabyteDB YSQL performance tuning (adjust to your hardware)
YB_YSQL_MAX_CONNECTIONS="500"
YB_YSQL_SHARED_BUFFERS="8GB"
YB_YSQL_EFFECTIVE_CACHE="24GB"
YB_YSQL_WORK_MEM="64MB"
YB_YSQL_MAINTENANCE_WORK_MEM="2GB"
YB_YSQL_WAL_BUFFERS="64MB"
YB_YSQL_MAX_WAL_SIZE="8GB"
YB_YSQL_MIN_WAL_SIZE="2GB"
YB_YSQL_CHECKPOINT_TARGET="0.9"
YB_YSQL_STATS_TARGET="500"
YB_YSQL_RANDOM_PAGE_COST="1.1"
YB_YSQL_IO_CONCURRENCY="200"
YB_IDLE_IN_TX_TIMEOUT="30000"
YB_STATEMENT_TIMEOUT="600000"
YB_LOCK_TIMEOUT="30000"
YB_DEADLOCK_TIMEOUT="1000"
YB_SLOW_QUERY_MS="2000"

# ── Database Credentials ──────────────────────────────────────────────────────
DB_SUPERUSER="yugabyte"
DB_SUPERUSER_PASS="StrongYBPassword!2024"
DB_ODOO_USER="odoo"
DB_ODOO_PASS="OdooSecurePass!2024"
DB_ODOO_NAME="odoo19_prod"
DB_TEMPLATE="template0"
DB_ENCODING="UTF8"

# ── Redis Credentials ─────────────────────────────────────────────────────────
REDIS_PASS="RedisSecurePass!2024"

# ── Odoo Software ─────────────────────────────────────────────────────────────
ODOO_VERSION="19.0"
ODOO_REPO="https://github.com/odoo/odoo.git"
ODOO_BRANCH="19.0"
ODOO_INSTALL_DIR="/opt/odoo"
ODOO_SOURCE_DIR="/opt/odoo/odoo19"
ODOO_VENV_DIR="/opt/odoo/venv19"
ODOO_CONFIG_DIR="/etc/odoo"
ODOO_CONFIG_FILE="/etc/odoo/odoo19.conf"
ODOO_LOG_DIR="/opt/odoo/logs"
ODOO_FILESTORE_DIR="/opt/odoo/filestore"
ODOO_SESSIONS_DIR="/opt/odoo/sessions"
ODOO_ADDONS_DIR="/opt/odoo/custom_addons"
ODOO_USER="odoo"
ODOO_GROUP="odoo"
ODOO_UID="1001"
ODOO_GID="1001"

# Odoo admin master password (plain — will be hashed during setup)
ODOO_MASTER_PASS="YourMasterPassword123!"

# Odoo worker tuning (adjust to your CPU count: workers = 2 × CPUs)
ODOO_WORKERS="16"
ODOO_MAX_CRON_THREADS="2"
ODOO_LIMIT_TIME_CPU="600"
ODOO_LIMIT_TIME_REAL="1200"
ODOO_LIMIT_MEMORY_HARD="2684354560"
ODOO_LIMIT_MEMORY_SOFT="2147483648"
ODOO_LIMIT_REQUEST="8192"
ODOO_DB_MAXCONN="64"
ODOO_LOG_LEVEL="info"

# ── SSL ───────────────────────────────────────────────────────────────────────
SSL_DIR="/etc/ssl/odoo"
SSL_COUNTRY="US"
SSL_STATE="California"
SSL_ORG="MyCompany"
SSL_CN="${CLUSTER_DOMAIN}"

# ── Backup ────────────────────────────────────────────────────────────────────
BACKUP_DIR="/backup/odoo"
BACKUP_RETENTION_DAYS="7"
BACKUP_YB_SNAPSHOT_INTERVAL_MIN="1440"
BACKUP_YB_SNAPSHOT_RETENTION_MIN="10080"

# ── Monitoring ────────────────────────────────────────────────────────────────
PROMETHEUS_HOST="prometheus-01"
PROMETHEUS_PORT="9090"
ALERT_EMAIL="admin@example.com"

# ── Internal Subnet (for firewall rules) ─────────────────────────────────────
INTERNAL_SUBNET="192.168.1.0/24"

# ── Wkhtmltopdf ──────────────────────────────────────────────────────────────
WKHTMLTOPDF_VERSION="0.12.6.1-3"
WKHTMLTOPDF_DEB_URL="https://github.com/wkhtmltopdf/packaging/releases/download/${WKHTMLTOPDF_VERSION}/wkhtmltox_${WKHTMLTOPDF_VERSION}.jammy_amd64.deb"
